<div class="container">
  <h2 class="text-center mb-4">Loan Amortization Calculator</h2>

  <div class="row">
    <!-- Left: Form -->
    <div class="col-md-6">
      <form [formGroup]="amortizationForm" (ngSubmit)="submitForm()">

        <!-- Loan Amount -->
        <div class="form-group">
          <label>Loan Amount</label>
          <input type="text" formControlName="LoanAmount" [(ngModel)]="amortizationForm.value.LoanAmount" class="form-control" />
          <input type="range" formControlName="LoanAmount" [(ngModel)]="amortizationForm.value.LoanAmount" min="100000" max="100000000" step="100000" class="form-control-range" />
        </div>

        <!-- Loan Term -->
        <div class="form-group">
          <label>Tenure (Years)</label>
          <input type="text" formControlName="LoanTermYears" [(ngModel)]="amortizationForm.value.LoanTermYears" class="form-control" />
          <input type="range" formControlName="LoanTermYears" [(ngModel)]="amortizationForm.value.LoanTermYears" min="1" max="40" step="1" class="form-control-range" />
        </div>

        <!-- Interest Rate -->
        <div class="form-group">
          <label>Interest Rate (%)</label>
          <input type="text" formControlName="InterestRate" [(ngModel)]="amortizationForm.value.InterestRate" class="form-control" />
          <input type="range" formControlName="InterestRate" [(ngModel)]="amortizationForm.value.InterestRate" min="0.5" max="25" step="0.25" class="form-control-range" />
        </div>

        <button type="submit" class="btn btn-primary btn-block mt-3">Calculate EMI</button>
      </form>
    </div>

    <!-- Right: Loan Summary & Chart -->
    <div class="col-md-6 text-center">
      <h4>Monthly EMI: {{ monthlyPayment | currency }}</h4>
      <p>Principal Amount: {{ amortizationForm.value.LoanAmount | currency }}</p>
      <p>Interest Amount: {{ totalInterest | currency }}</p>
      <p>Total Payable: {{ totalPayment | currency }}</p>
      <canvas id="pieChart"></canvas>
    </div>
  </div>

  <!-- Amortization Schedule Table -->
  <table class="table mt-4">
    <thead>
      <tr>
        <th>Month</th>
        <th>Principal</th>
        <th>Interest</th>
        <th>Total Payment</th>
        <th>Balance</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let row of amortizationSchedule$ | async">
        <td>{{ row.PaymentNumber }}</td>
        <td>{{ row.PrincipalPayment | currency }}</td>
        <td>{{ row.InterestPayment | currency }}</td>
        <td>{{ row.MonthlyPayment | currency }}</td>
        <td>{{ row.RemainingBalance | currency }}</td>
      </tr>
    </tbody>
  </table>
</div>
